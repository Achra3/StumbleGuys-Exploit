const { default: Axios } = require('axios');
const cfonts = require('cfonts');
const chalk = require('chalk');
const rs = require('readline-sync');
const moment = require("moment-timezone");
moment.tz.setDefault('Asia/Jakarta').locale('id')

async function start() {
    
    cfonts.say('STUMBLE GUYS|EXPLOIT', {
        font: 'shade',   
        align: 'center',
        colors: ['yellow','green'],
        background: 'transparent',
        letterSpacing: 1,
        lineHeight: 1,
        space: true,
        maxLength: '0',
        gradient: false,
        independentGradient: false,
        transitionGradient: false,
        env: 'node'
    });
    console.log(chalk.blue('======================================'))
    console.log(chalk.green('Creator : Tobz'))
    console.log(chalk.green('Instagram : ini.tobz'))
    console.log(chalk.green('WhatsApp : 081311850715'))
    console.log(chalk.blue('======================================'))

    const code = rs.question(chalk.green("[ ! ]") + " Input Your Auth : ");
    if (code.length === 0) { 
        console.log(chalk.red("[ x ]") +  " Please Input Your Auth!");
    }
    console.log(`
[ 1 ] Round 1
[ 2 ] Round 2
[ 3 ] Round 3
`)
    var list = ["1", "2", "3"]
    var round = rs.question(chalk.green("[ ! ]") + " Input Your Round (1, 2, 3) : ");
        if (round.length === 0) {
            console.log(chalk.red("[ x ]") +  " Please Input Round!");
            round = rs.question(chalk.green("[ ! ]") + " Input Your Round (1, 2, 3) : ");
        }
        if (!Number(round)) { 
            console.log(chalk.red("[ x ]") +  " Please Input Round With Numbers Not Letters!");
            round = rs.question(chalk.green("[ ! ]") + " Input Your Round (1, 2, 3): ");
        }
        if (!list.includes(round)) { 
            console.log(chalk.red("[ x ]") +  " Please Input The Number Of Rounds Correctly!");
            round = rs.question(chalk.green("[ ! ]") + " Input Your Round (1, 2, 3): ");
        }
    var delay = rs.question(chalk.green("[ ! ]") + " Input Delay (Minimum : 3) : ");
        if (delay.length === 0) {
            console.log(chalk.red("[ x ]") +  " Please Input Delay!");
            delay = rs.question(chalk.green("[ ! ]") + " Input Delay (Minimum : 3) : ");
        }
        if (!Number(delay)) { 
            console.log(chalk.red("[ x ]") +  " Please Input Delay With Numbers Not Letters!");
            delay = rs.question(chalk.green("[ ! ]") + " Input Delay (Minimum : 3) : ");
        }
        if (delay < 3) {
            console.log(chalk.red("[ x ]") +  " The Minimum Delay Is 3 To Reduce The Risk Of Being Banned!");
            delay = rs.question(chalk.green("[ ! ]") + " Input Delay (Minimum : 3) : ");
        }

    console.log("")
    
    while(true) {

        const result = await runExploit(code, round, delay)
        if (!result) {
            console.log(chalk.red("[ x ]") + " YOUR AUTH IS INVALID OR HAS EXPIRED!")
            console.log(chalk.red("[ x ]") + " PLEASE CHECK YOUR AUTH TOKEN AGAIN!")
            return
        } else if (result.User) {
            console.log(chalk.green("[ + ]") + " | " + moment().format("HH:mm:ss") + " | " + chalk.blue(result.User.Username) + " | " +  chalk.red(result.User.Country) + " | " + chalk.yellow(result.User.SkillRating) + " Thropies" + " | " + chalk.yellow(result.User.Crowns) + " Crowns")
        } else if (result.includes("BANNED")) {
          console.log(chalk.red("[ x ]") + " YOUR ACCOUNT HAS BEEN BANNED!")
          return
        } 

    }

}
start()

async function runExploit(code, round, delay) {
    return new Promise((resolve, reject) => {
        Axios.get(`http://kitkabackend.eastus.cloudapp.azure.com:5010/round/finishv2/${round}`, {
            headers: {
                "authorization": code,
                "use_response_compression": true,
                "Accept-Encoding": "gzip",
                "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:101.0) Gecko/20100101 Firefox/101.0"
            }
        }).then(async (result) => {
            await reqDelay(delay * 1000)
            resolve(result.data)
        }).catch((e) => {
            resolve(e.response.data)
        });
    })
}

async function reqDelay (ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}